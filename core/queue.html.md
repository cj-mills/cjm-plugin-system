# Job Queue


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

The
[`JobQueue`](https://cj-mills.github.io/cjm-plugin-system/core/queue.html#jobqueue)
provides a resource-aware job queue for plugin execution:

    ┌─────────────────────────────────────────────────────────────┐
    │                    User Application                         │
    │  ┌─────────────────────────────────────────────────────┐    │
    │  │                    JobQueue                         │    │
    │  │  ┌───────────┐  ┌───────────┐  ┌───────────────┐    │    │
    │  │  │ Pending   │  │ Running   │  │ History       │    │    │
    │  │  │ Jobs      │→ │ Job       │→ │ (completed/   │    │    │
    │  │  │ (heap)    │  │           │  │  cancelled)   │    │    │
    │  │  └───────────┘  └───────────┘  └───────────────┘    │    │
    │  └─────────────────────────────────────────────────────┘    │
    │         │                │                                  │
    │         ▼                ▼                                  │
    │  ┌─────────────┐  ┌─────────────┐                           │
    │  │ Scheduler   │  │ Plugin      │                           │
    │  │ (policy)    │  │ Manager     │                           │
    │  └─────────────┘  └─────────────┘                           │
    └─────────────────────────────────────────────────────────────┘

Key features:

- **Priority queue**: Higher priority jobs execute first (FIFO within
  same priority)
- **Resource-aware**: Waits for resources, triggers eviction of idle
  plugins
- **Cancellation**: Cancel pending or running jobs with graceful
  fallback to force termination
- **Progress tracking**: Poll progress and status messages during
  execution
- **Observable**: Get queue state for UI integration

## JobStatus

Enumeration of possible job states.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L29"
target="_blank" style="float:right; font-size:smaller">source</a>

### JobStatus

``` python

def JobStatus(
    args:VAR_POSITIONAL, kwds:VAR_KEYWORD
):

```

*Status of a job in the queue.*

## Job

Dataclass representing a queued plugin execution.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L39"
target="_blank" style="float:right; font-size:smaller">source</a>

### Job

``` python

def Job(
    id:str, plugin_name:str, args:Tuple, kwargs:Dict, status:JobStatus=<JobStatus.pending: 'pending'>,
    priority:int=0, created_at:float=<factory>, started_at:Optional=None, completed_at:Optional=None,
    result:Any=None, error:Optional=None, progress:float=0.0, status_message:str=''
)->None:

```

*A queued plugin execution request.*

## JobQueue

Main queue class that manages job submission, execution, and lifecycle.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L62"
target="_blank" style="float:right; font-size:smaller">source</a>

### JobQueue

``` python

def JobQueue(
    manager:PluginManager, # Plugin manager instance
    max_history:int=100, # Max completed jobs to retain
    cancel_timeout:float=3.0, # Seconds to wait for cooperative cancel
    progress_poll_interval:float=1.0, # Seconds between progress polls
):

```

*Resource-aware job queue for sequential plugin execution.*

### Job Submission

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L96"
target="_blank" style="float:right; font-size:smaller">source</a>

### submit

``` python

async def submit(
    plugin_name:str, # Target plugin
    args:VAR_POSITIONAL, priority:int=0, # Higher = more urgent
    kwargs:VAR_KEYWORD
)->str: # Returns job_id

```

*Submit a job to the queue.*

### Job Control

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L154"
target="_blank" style="float:right; font-size:smaller">source</a>

### reorder

``` python

def reorder(
    job_id:str, # Job to move
    new_priority:int, # New priority value
)->bool: # True if reordered

```

*Change the priority of a pending job.*

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/proxy.py#L271"
target="_blank" style="float:right; font-size:smaller">source</a>

### cancel

``` python

async def cancel(
    job_id:str, # Job to cancel
)->bool: # True if cancelled

```

*Cancel a pending or running job.*

### Observation

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L246"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_job_logs

``` python

def get_job_logs(
    job_id:str, # Job to get logs for
    lines:int=100, # Max lines to return
)->str: # Log content

```

*Get logs for a job from the plugin’s log file.*

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L200"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_state

``` python

def get_state(
    
)->Dict: # Queue state for UI

```

*Get the current queue state.*

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L180"
target="_blank" style="float:right; font-size:smaller">source</a>

### wait_for_job

``` python

async def wait_for_job(
    job_id:str, # Job to wait for
    timeout:Optional=None, # Max seconds to wait
)->Job: # Completed/failed/cancelled job

```

*Wait for a job to complete.*

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L173"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_job

``` python

def get_job(
    job_id:str, # Job to retrieve
)->Optional: # Job or None

```

*Get a job by ID.*

### Lifecycle

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L273"
target="_blank" style="float:right; font-size:smaller">source</a>

### stop

``` python

async def stop(
    
)->None:

```

*Stop the queue processor gracefully.*

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-plugin-system/blob/main/cjm_plugin_system/core/queue.py#L264"
target="_blank" style="float:right; font-size:smaller">source</a>

### start

``` python

async def start(
    
)->None:

```

*Start the queue processor.*

### Internal Methods

## Usage Example

``` python
from cjm_plugin_system.core.manager import PluginManager
from cjm_plugin_system.core.queue import JobQueue, JobStatus
from cjm_plugin_system.core.scheduling import QueueScheduler

# Setup
manager = PluginManager(scheduler=QueueScheduler())
manager.discover_manifests()
manager.load_plugin(manager.get_discovered_meta("sys-mon"))
manager.register_system_monitor("sys-mon")

# Create queue
queue = JobQueue(manager)
await queue.start()

# Submit jobs
job1_id = await queue.submit("whisper", audio="/path/to/audio1.mp3")
job2_id = await queue.submit("gemini-vision", image="/path/to/image.png")
job3_id = await queue.submit("whisper", audio="/path/to/audio2.mp3", priority=10)

# Monitor queue state
state = queue.get_state()
print(f"Running: {state['running']}")
print(f"Pending: {len(state['pending'])} jobs")

# Cancel a job
await queue.cancel(job2_id)

# Wait for a job to complete
job1 = await queue.wait_for_job(job1_id)
if job1.status == JobStatus.completed:
    print(job1.result)

# Cleanup
await queue.stop()
manager.unload_all()
```
